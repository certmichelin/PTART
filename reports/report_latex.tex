%-----------------------------------------------------------------%
%         Template based on cyber@cfreg LaTeX template            %
%                                                                 %
% https://github.com/cyber-cfreg/Penetration-Test-Report-Template %
%-----------------------------------------------------------------%

\documentclass[12pt, table,dvipsnames]{article}

%-----------------------------------------------------%
% Package import                                      %
%-----------------------------------------------------%
\usepackage[export]{adjustbox}
\usepackage{afterpage}
\usepackage{appendix}
\usepackage[USenglish]{babel}
\usepackage[style=numeric,backend=biber, sorting=none]{biblatex}
\usepackage{booktabs}
\usepackage{capt-of}
\usepackage[tableposition=top]{caption}
\usepackage{csquotes}
\usepackage{easyfig}
\usepackage{fancyhdr}
\usepackage[T1]{fontenc}
\usepackage{float}
\usepackage[letterpaper,left=2.5cm,right=2.5cm,top=2.5cm,bottom=2.5cm,headheight=15pt]{geometry}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{ifthen}
\usepackage[utf8]{inputenc}
\usepackage{listings}
\usepackage{lmodern}
\usepackage{longtable}
\usepackage{lscape}
\usepackage{makecell}
\usepackage{mathptmx}
\usepackage[parfill]{parskip}
\usepackage[final]{pdfpages}
\usepackage{pgf-pie}  
\usepackage{placeins}
\usepackage{rotating}
\usepackage{tabularx}
\usepackage{tabulary}
\usepackage{tikz}
\usepackage{tocloft}
\usepackage{wrapfig}
\usepackage{xcolor}
\usepackage{xcolor}
\usepackage{xurl}
%-----------------------------------------------------%
% End of Package import                               %
%-----------------------------------------------------%

%-----------------------------------------------------%
% Aliases                                             %
%-----------------------------------------------------%
\newcommand{\doctitle}{Pentest Report}
\newcommand{\project}{\VAR{project.name}}
\newcommand{\teamname}{Michelin CERT}
\newcommand{\company}{Michelin}
\newcommand{\classification}{CONFIDENTIAL}
\newcommand{\logopath}{resources/logo.png}
\newcommand{\companylogo}{resources/companylogo.png}
%-----------------------------------------------------%
% End of Aliases                                      %
%-----------------------------------------------------%

%-----------------------------------------------------%
% Docstyle                                            %
%-----------------------------------------------------%   
\lhead{}
\rhead{\project\ - \teamname}
\cfoot{\color{red}{\classification}}
\rfoot{Page \thepage}

\floatstyle{plaintop}
\restylefloat{table}

% For dotted table of content
\makeatletter
\renewcommand*\l@section{\@dottedtocline{1}{1.5em}{2.3em}}
\renewcommand*\l@subsection{\@dottedtocline{2}{2.3em}{3.2 em}}
\makeatother

%more control over table layouts
\newcolumntype{R}{>{\raggedleft\arraybackslash}X}
\restylefloat{table}

% Horizontal line and separator
\newcommand{\HRule}{\rule{\linewidth}{0.5mm}}
\newcommand{\hseparator}{\hspace{0.3em}-\hspace{0.3em}}

\fancypagestyle{footmark}{
	\ps@@fancy % use {fancy} style as a base of {footmark}
	\fancyfoot[C]{\footmark}
}

% sets value of \footmark and sets the correct style for this page only
\newcommand\markfoot[1]{\gdef\footmark{#1}\thispagestyle{footmark}}

% Page layout
\pagestyle{fancy}

\addbibresource{references.bib}
\hypersetup{colorlinks, allcolors=black}
%-----------------------------------------------------%
% End of Docstyle                                     %
%-----------------------------------------------------%                                          
%-----------------------------------------------------%
% Begin Document                                      %
%-----------------------------------------------------%
\begin{document}

\title{\doctitle}
\pagenumbering{arabic}

%-----------------------------------------------------%
% Title Page                                          %
%-----------------------------------------------------%
\begin{titlepage}
	\begin{center}
		
		\vspace{0.25cm}
		\begin{figure}[H]
			\centering
			\includegraphics[width=\textwidth/3]{\logopath}
		\end{figure}
		
		% Title
		\HRule\\[0.2cm]
		{\huge\bfseries\doctitle : \\ \project}
		\HRule\\[0.5cm]
		\vfill
		% End of Title
		
		% Team Name
		\Large{Conducted by:}
		\LARGE{\textbf{\teamname}}
		\vfill
		% End of Team Name
		
		% Date
		\Large{From \VAR{ project.start_date } to \VAR{ project.end_date }}
		\vfill
		% End of Date
		
		% Pentesters.
		Auditor(s):
		\begin{center}
			\small{
			\begin{itemize}
				\centering
				\BLOCK{ for pentester in project.pentesters.all() }
					\item[] \VAR{ pentester.username } - \VAR{ pentester.first_name } \VAR{ pentester.last_name }
				\BLOCK{ endfor }
			\end{itemize}
			}
		\end{center}
		\vfill
		% End of Pentesters.
		
		\includegraphics[width=\textwidth/4]{\companylogo}
				
		% % Bottom of the page
		{\footnotesize {\color{red}{\classification}}}
		
	\end{center}
\end{titlepage}
%-----------------------------------------------------%
% End of Title Page                                   %
%-----------------------------------------------------%

%-----------------------------------------------------%
% Table of Contents                                   %
%-----------------------------------------------------%
\renewcommand{\contentsname}{Table of Contents}
\tableofcontents\thispagestyle{fancy}
\newpage
%-----------------------------------------------------%
% End of Table of Contents                            %
%-----------------------------------------------------%

%-----------------------------------------------------%
% Executive Summary                                   %
%-----------------------------------------------------%
\section{Report Overview}
\subsection{Executive Summary}

\VAR{ project.introduction | mdtolatex }

\end{document}